{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- $caption := .Get "caption" -}}
{{- $width := .Get "width" | default 800 -}}
{{- $class := .Get "class" | default "article-image" -}}

{{- if $src -}}
  {{- /* Try to get from resources first (assets/) */ -}}
  {{- $image := resources.Get $src -}}
  {{- if $image -}}
    {{- $resized := $image.Resize (printf "%dx" $width) -}}
    <figure class="{{ $class }}" style="max-width: {{ $width }}px;">
      <img 
        src="{{ $resized.RelPermalink }}" 
        alt="{{ $alt }}"
        width="{{ $resized.Width }}"
        height="{{ $resized.Height }}"
        loading="lazy"
        decoding="async"
      >
      {{- if $caption -}}
      <figcaption>{{ $caption }}</figcaption>
      {{- end -}}
    </figure>
  {{- else -}}
    {{- /* Fallback for static/ images or external URLs */ -}}
    <figure class="{{ $class }}" style="max-width: {{ $width }}px;">
      <img 
        src="{{ $src | relURL }}" 
        alt="{{ $alt }}"
        loading="lazy"
        decoding="async"
      >
      {{- if $caption -}}
      <figcaption>{{ $caption }}</figcaption>
      {{- end -}}
    </figure>
  {{- end -}}
{{- end -}}

